<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{email.edited.header}">Your Order Has Been Updated</title>
</head>
<body style="margin: 0; padding: 0; font-family: Arial, sans-serif; line-height: 1.6; background-color: #f4f4f4;">

<!-- Main Container -->
<table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #f4f4f4;">
    <tr>
        <td align="center" style="padding: 20px;">

            <!-- Email Container -->
            <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="600" style="background-color: #ffffff; border-radius: 8px;">

                <!-- Header -->
                <tr>
                    <td style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: #ffffff; padding: 30px; text-align: center; border-radius: 8px 8px 0 0;">
                        <h1 style="margin: 0; font-size: 24px; font-weight: bold;" th:text="#{email.edited.header}">‚úèÔ∏è Your Order Has Been Updated</h1>
                        <p style="margin: 10px 0 0 0; font-size: 16px;" th:text="#{email.edited.subtitle}">Your order has been modified by admin</p>
                    </td>
                </tr>

                <!-- Content -->
                <tr>
                    <td style="padding: 30px;">

                        <!-- Greeting -->
                        <p style="margin: 0 0 20px 0; font-size: 16px;">
                            <strong><span th:text="#{email.greeting.dear}">Dear</span> <span th:text="${customer != null ? (customer.firstName + ' ' + customer.lastName) : #{email.greeting.valued_customer}}">John Doe</span>,</strong>
                        </p>

                        <!-- Alert Box -->
                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; margin: 20px 0;">
                            <tr>
                                <td style="padding: 20px; text-align: center;">
                                    <h3 style="margin: 0 0 10px 0; color: #856404; font-size: 18px;" th:text="#{email.edited.alert_title}">‚ö†Ô∏è Important Information</h3>
                                    <p style="margin: 0; color: #856404;" th:utext="#{email.edited.alert_message}">Your order has been modified and <strong>awaiting your approval</strong>.</p>
                                    <p style="margin: 10px 0 0 0; color: #856404;" th:text="#{email.edited.review_notice}">Please review the changes and approve or reject them.</p>
                                </td>
                            </tr>
                        </table>

                        <!-- Order Info -->
                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #fff8e1; border-left: 4px solid #ff9800; border-radius: 5px; margin: 20px 0;">
                            <tr>
                                <td style="padding: 20px;">
                                    <h3 style="margin: 0 0 15px 0; color: #ff9800; font-size: 16px;" th:text="#{email.edited.order_info}">üìã Order Information</h3>
                                    <p style="margin: 5px 0;"><strong th:text="#{email.common.order_number}">Order No:</strong> <span th:text="${order != null ? order.orderNumber : 'N/A'}">ORD-2024-001</span></p>
                                    <p style="margin: 5px 0;"><strong th:text="#{email.edited.original_date}">Original Date:</strong> <span th:text="${formattedDate != null ? formattedDate : 'N/A'}">01.08.2024 14:30</span></p>
                                    <p style="margin: 5px 0;"><strong th:text="#{email.common.status}">Status:</strong>
                                        <span style="background: #fff3cd; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; color: #856404;" th:text="#{email.edited.status_pending}">
                                                AWAITING EDIT APPROVAL
                                            </span>
                                    </p>
                                    <p style="margin: 5px 0;"><strong th:text="#{email.common.dealer}">Dealer:</strong> <span th:text="${dealer != null ? dealer.name : 'N/A'}">Dealer Name</span></p>
                                </td>
                            </tr>
                        </table>

                        <div th:if="${hasDiscount}" class="order-info" style="background: #fff8e1; border-left-color: #ff9800;">
                            <h3 th:text="#{email.edited.discount_info}">üí∞ Discount Information</h3>
                            <p><strong th:text="#{email.edited.applied_discount}">Applied Discount:</strong> <span th:text="${discountName}">Winter Campaign</span></p>
                            <p><strong th:text="#{email.edited.discount_amount}">Discount Amount:</strong> <span th:text="${formattedDiscountAmount}+ ' ' + currency">75.00 TL</span></p>
                            <p style="font-size: 14px; color: #666;"><em th:text="#{email.edited.discount_recalculated}">* Discount has been recalculated on the new order amount</em></p>
                        </div>


                        <!-- Comparison Section -->
                        <h3 style="text-align: center; color: #ff9800; margin: 30px 0 20px 0; font-size: 18px;" th:text="#{email.edited.comparison}">üìä Change Comparison</h3>

                        <table role="presentation" cellspacing="0" cellpadding="15" border="0" width="100%">
                            <tr>
                                <!-- Before -->
                                <td width="48%" style="background-color: #ffebee; border: 2px solid #e57373; border-radius: 8px; vertical-align: top;">
                                    <h4 style="margin: 0 0 10px 0; text-align: center; color: #d32f2f; font-size: 14px; text-transform: uppercase;" th:text="#{email.edited.before}">‚ùå Before</h4>

                                    <div th:if="${originalItems != null and not #lists.isEmpty(originalItems)}">
                                        <div th:each="item : ${originalItems}" style="background: rgba(255,255,255,0.7); padding: 8px; margin: 3px 0; border-radius: 4px; font-size: 13px;">
                                            <strong th:text="${item.productName != null ? item.productName : 'Product'}">Product Name</strong><br/>
                                            <span><span th:text="${item.quantity != null ? item.quantity : '0'}">2</span> <span th:text="#{email.common.quantity_unit}">pcs</span></span>
                                            <small th:if="${item.productVariant != null && item.productVariant.size != null}"
                                                   style="color: #888; font-style: italic; font-size: 11px;"><span th:text="#{email.common.variant_size}">Variant</span>: <span th:text="${item.productVariant.size}">4.5mm</span></small>
                                            <small th:if="${item.productVariant != null && item.productVariant.sku != null}"
                                                   style="color: #888; font-style: italic; font-size: 11px;"> | <span th:text="#{email.common.sku}">SKU</span>: <span th:text="${item.productVariant.sku}">TI-001-45</span></small>
                                        </div>
                                    </div>

                                    <div th:if="${originalItems == null or #lists.isEmpty(originalItems)}" style="font-style: italic; color: #666; font-size: 13px;" th:text="#{email.edited.no_original_data}">
                                        Original item information not available
                                    </div>
                                </td>

                                <td width="4%"></td>

                                <!-- After -->
                                <td width="48%" style="background-color: #e8f5e8; border: 2px solid #81c784; border-radius: 8px; vertical-align: top;">
                                    <h4 style="margin: 0 0 10px 0; text-align: center; color: #388e3c; font-size: 14px; text-transform: uppercase;" th:text="#{email.edited.after}">‚úÖ After</h4>

                                    <div th:if="${orderItems != null and not #lists.isEmpty(orderItems)}">
                                        <div th:each="item : ${orderItems}" style="background: rgba(255,255,255,0.7); padding: 8px; margin: 3px 0; border-radius: 4px; font-size: 13px;">
                                            <strong th:text="${item.productName != null ? item.productName : 'Product'}">New Product Name</strong><br/>
                                            <span><span th:text="${item.quantity != null ? item.quantity : '0'}">2</span> <span th:text="#{email.common.quantity_unit}">pcs</span></span>
                                            <small th:if="${item.productVariant != null && item.productVariant.size != null}"
                                                   style="color: #888; font-style: italic; font-size: 11px;"><span th:text="#{email.common.variant_size}">Variant</span>: <span th:text="${item.productVariant.size}">4.5mm</span></small>
                                            <small th:if="${item.productVariant != null && item.productVariant.sku != null}"
                                                   style="color: #888; font-style: italic; font-size: 11px;"> | <span th:text="#{email.common.sku}">SKU</span>: <span th:text="${item.productVariant.sku}">TI-001-45</span></small><br
                                                   th:if="${item.productVariant != null && (item.productVariant.size != null || item.productVariant.sku != null)}"/>
                                             <span th:text="${item.quantity != null and item.totalPrice != null ?
                                                (item.quantity + ' ' + #{email.common.quantity_unit} + ' - ' + item.totalPrice + ' ' + currency)
                                                : 'Info not available'}">
                                            </span>
                                        </div>
                                    </div>

                                    <div th:if="${orderItems == null or #lists.isEmpty(orderItems)}" style="font-style: italic; color: #666; font-size: 13px;" th:text="#{email.edited.no_new_data}">
                                        New item information not available
                                    </div>
                                </td>
                            </tr>
                        </table>

                        <!-- Total Comparison -->
                        <div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3 style="color: #f57c00; margin-top: 0;">üí∞ Tutar Kar≈üƒ±la≈ütƒ±rmasƒ±</h3>

                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-weight: bold;">√ñnceki Tutar:</td>
                                    <td style="padding: 10px; text-align: right;">
                                        <span style="text-decoration: line-through; color: #999;" th:text="${formattedOriginalTotal}">0 TL</span>
                                    </td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-weight: bold;">Yeni Tutar:</td>
                                    <td style="padding: 10px; text-align: right;">
                                        <span style="font-size: 18px; font-weight: bold; color: #2e7d32;" th:text="${formattedTotal}">0 TL</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; font-weight: bold;">Fark:</td>
                                    <td style="padding: 10px; text-align: right;">
                                        <!-- ‚úÖ AZALISÃß -->
                                        <span th:if="${totalDecreased}" style="font-size: 16px; font-weight: bold; color: #2e7d32;">
                                ‚¨áÔ∏è      <span th:text="${formattedTotalDifference}">0 TL</span> ƒ∞ndirim
                                        </span>

                                        <!-- ‚úÖ ARTISÃß -->
                                        <span th:if="${totalIncreased}" style="font-size: 16px; font-weight: bold; color: #d32f2f;">
                                        ‚¨ÜÔ∏è +<span th:text="${formattedTotalDifference}">0 TL</span> Artƒ±≈ü
                                            </span>

                                        <!-- ‚úÖ DEƒûƒ∞≈ûMEDƒ∞ -->
                                        <span th:if="${totalUnchanged}" style="font-size: 16px; color: #666;">
                                            Tutar Deƒüi≈ümedi
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Bilgilendirme Banner'ƒ± -->
                        <div th:if="${totalDecreased}"
                             style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; margin: 20px 0; border-radius: 4px;">
                            <strong style="color: #2e7d32;">‚úÖ Tasarruf D√º≈ü√º≈ü√º!</strong><br>
                            Sipari≈ü tutarƒ±nƒ±z <span th:text="${formattedTotalDifference}">0 TL</span> azaldƒ±.
                        </div>

                        <div th:if="${totalIncreased}"
                             style="background: #ffebee; border-left: 4px solid #f44336; padding: 15px; margin: 20px 0; border-radius: 4px;">
                            <strong style="color: #c62828;">‚ö†Ô∏è Tutar Artƒ±≈üƒ±</strong><br>
                            Sipari≈ü tutarƒ±nƒ±z <span th:text="${formattedTotalDifference}">0 TL</span> arttƒ±.
                        </div>

                        <!-- Edit Reason -->
                        <table th:if="${editReason != null and editReason != 'D√ºzenleme nedeni belirtilmemi≈ü'}"
                               role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%"
                               style="background-color: #fff8e1; border-left: 4px solid #ff9800; border-radius: 5px; margin: 20px 0;">
                            <tr>
                                <td style="padding: 20px;">
                                    <h3 style="margin: 0 0 10px 0; color: #ff9800; font-size: 16px;">üìù D√ºzenleme Nedeni</h3>
                                    <p style="margin: 0; font-style: italic; color: #555;" th:text="${editReason}">Stok durumu g√ºncellendiƒüi i√ßin miktar deƒüi≈ütirildi.</p>
                                </td>
                            </tr>
                        </table>

                        <!-- Action Required -->
                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; margin: 25px 0;">
                            <tr>
                                <td style="padding: 20px; text-align: center;">
                                    <h3 style="margin: 0 0 10px 0; color: #856404;">‚è∞ Onay Bekleniyor</h3>
                                    <p style="margin: 0 0 10px 0; color: #856404;"><strong>Bu deƒüi≈üiklikleri onaylamanƒ±z gerekiyor!</strong></p>
                                    <p style="margin: 0 0 20px 0; color: #856404;">48 saat i√ßinde i≈ülem yapmazsanƒ±z sipari≈ü otomatik olarak iptal edilecektir.</p>

                                    <!-- Action Buttons -->
                                    <table role="presentation" cellspacing="0" cellpadding="0" border="0" align="center">
                                        <tr>
                                            <td>
                                                <a th:href="${orderDetailUrlEdit != null ? (orderDetailUrlEdit + '?approved=true') : '#'}"
                                                   style="background-color: #4caf50; color: #ffffff; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block; margin: 5px;">
                                                    ‚úÖ Deƒüi≈üiklikleri Onayla veya Reddet
                                                </a>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <!-- Important Info -->
                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 5px; margin: 20px 0;">
                            <tr>
                                <td style="padding: 20px;">
                                    <h3 style="margin: 0 0 15px 0; color: #2196f3; font-size: 16px;">üí° √ñnemli Bilgiler</h3>
                                    <p style="margin: 5px 0;"><strong>‚úÖ Onaylarsanƒ±z:</strong> Sipari≈ü yeni haliyle i≈üleme alƒ±nacak</p>
                                    <p style="margin: 5px 0;"><strong>‚ùå Reddederseniz:</strong> Sipari≈ü iptal edilecek ve stoklar iade edilecek</p>
                                    <p style="margin: 5px 0;"><strong>‚è∞ ƒ∞≈ülem Yapmazsanƒ±z:</strong> 48 saat sonra otomatik iptal</p>
                                </td>
                            </tr>
                        </table>

                    </td>
                </tr>

                <!-- Footer -->
                <tr>
                    <td style="background-color: #f9f9f9; padding: 20px; text-align: center; border-radius: 0 0 8px 8px;">
                        <p style="margin: 0 0 5px 0; font-weight: bold; color: #333;">üè• MEDƒ∞NTERA</p>
                        <p style="margin: 0 0 5px 0; font-size: 12px; color: #666;">Bu e-posta otomatik olarak g√∂nderilmi≈ütir. Sorularƒ±nƒ±z i√ßin m√º≈üteri hizmetlerimizle ileti≈üime ge√ßebilirsiniz.</p>
                        <p style="margin: 0 0 5px 0; font-weight: bold; font-size: 12px; color: #666;">üìû Destek: 0507 916 4273 / 0321 750 04 16 | üìß bilgi@medintera.com.tr</p>
                        <p style="margin: 15px 0 0 0; font-size: 10px; color: #999;">
                            ¬© <span th:text="${#dates.year(#dates.createNow())}">2025</span> Medintera. T√ºm haklarƒ± saklƒ±dƒ±r.
                        </p>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</body>
</html>